filtered_data_genus_all <- rbind(filtered_data_genus, filtered_data_genus_max, filtered_data_genus_min)
# Filter the joined data frame based on the minimum and maximum values for only Metazoa
filtered_data_metazoan <- filtered_data_genus_all %>% filter(grepl("Metazoa",tax_path), grepl("\\bgenus\\b", tax_rank))
View(joined_data)
joined_data$Age <- metadataAge$Median[match(gsub("^[^-]+-[^-]+-([^_]+)_.*$", "\\1", joined_data$sample), metadataAge$Sample)]
###save csv
write.csv(filtered_data_metazoan, file = "cleanedData/filtered_metazoan_all.csv")
write.csv(filtered_data_genus_all, file = "cleanedData/filtered_genus_all.csv")
ggplot() +
geom_jitter(data = subset(joined_data, grepl("Metazoa", tax_path)), aes(x=Age, y=MAP_damage, size = N_reads), alpha =0.5) +
geom_line(data = mfd, aes(x=age, y=DNAdamage, color=category), size = 1) +
scale_color_brewer(palette="Spectral") +
geom_point(data = mfd, aes(x=age, y=DNAdamage, color=category), size = 2) +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage < min ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage > max ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
scale_size_continuous(trans="sqrt") +
xlab("Age in Years BP")
#plot damage profiles and mean length of Metazoa by age
pd <- position_dodge(0.5)
p1 <- ggplot(filtered_data_metazoan, aes(x=MAP_damage, y=tax_name, shape = tax_name, colour= Damage_model)) +
geom_errorbar(aes(xmin=MAP_damage-MAP_damage_std, xmax=MAP_damage+MAP_damage_std, group=Age), position=pd) +
geom_point(size = 2.2, position=pd)+
scale_shape_manual(values = c(8,12,17,18,19,15,13,4), name = "Tax name")+ #change symbol
scale_color_manual(values = c("Outlier" = "red", "Fitting" = "black"), name = "Damage_model")+
scale_y_discrete(limits = rev(levels(filtered_data_metazoan$Age)))+
facet_grid(Age ~ ., scales = "free_y", space = "free_y", switch = "y") +
theme(strip.placement = "outside")+
theme_minimal()
# Filter the joined data frame based on the minimum and maximum values for only Metazoa
filtered_data_metazoan <- filtered_data_genus_all %>% filter(grepl("Metazoa",tax_path), grepl("\\bgenus\\b", tax_rank))
filtered_data_metazoan$Age <- metadataAge$Median[match(gsub("^[^-]+-[^-]+-([^_]+)_.*$", "\\1", filtered_data_metazoan$sample), metadataAge$Sample)]
#plot damage profiles and mean length of Metazoa by age
pd <- position_dodge(0.5)
p1 <- ggplot(filtered_data_metazoan, aes(x=MAP_damage, y=tax_name, shape = tax_name, colour= Damage_model)) +
geom_errorbar(aes(xmin=MAP_damage-MAP_damage_std, xmax=MAP_damage+MAP_damage_std, group=Age), position=pd) +
geom_point(size = 2.2, position=pd)+
scale_shape_manual(values = c(8,12,17,18,19,15,13,4), name = "Tax name")+ #change symbol
scale_color_manual(values = c("Outlier" = "red", "Fitting" = "black"), name = "Damage_model")+
scale_y_discrete(limits = rev(levels(filtered_data_metazoan$Age)))+
facet_grid(Age ~ ., scales = "free_y", space = "free_y", switch = "y") +
theme(strip.placement = "outside")+
theme_minimal()
p1
p2 <- ggplot(filtered_data_metazoan, aes(x=mean_L, y=tax_name, shape = tax_name, colour= Damage_model)) +
geom_errorbar(aes(xmin=mean_L-std_L, xmax=mean_L+std_L, group=Age), position=pd) +
geom_point(size = 2.2, position=pd)+
scale_shape_manual(values = c(8,12,17,18,19,15,13,4), name = "Tax name")+ #change symbol
scale_color_manual(values = c("Outlier" = "red", "Fitting" = "black"), name = "Damage_model")+
scale_y_discrete(limits = rev(levels(filtered_data_metazoan_nc$Age)))+
facet_grid(Age ~ ., scales = "free_y", space = "free_y", switch = "y") +
theme(strip.placement = "outside")+
theme_minimal()
p2
#plot metazoan reads and identify outliers based on the damage model
pdf(file = "figures/MTG.DNAdamageJitterPlot_finalAnimals100readsWithOutliers.pdf", width = 12, height = 6)
ggplot() +
geom_jitter(data = subset(joined_data, grepl("Metazoa", tax_path)), aes(x=Age, y=MAP_damage, size = N_reads), alpha =0.5) +
geom_line(data = mfd, aes(x=age, y=DNAdamage, color=category), size = 1) +
scale_color_brewer(palette="Spectral") +
geom_point(data = mfd, aes(x=age, y=DNAdamage, color=category), size = 2) +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage < min ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage > max ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
scale_size_continuous(trans="sqrt") +
xlab("Age in Years BP")
dev.off()
#plot metazoan reads and identify outliers based on the damage model
pdf(file = "figures/MTG.DNAdamageJitterPlot_finalAnimals100readsWithOutliers.pdf", width = 9, height = 6)
ggplot() +
geom_jitter(data = subset(joined_data, grepl("Metazoa", tax_path)), aes(x=Age, y=MAP_damage, size = N_reads), alpha =0.5) +
geom_line(data = mfd, aes(x=age, y=DNAdamage, color=category), size = 1) +
scale_color_brewer(palette="Spectral") +
geom_point(data = mfd, aes(x=age, y=DNAdamage, color=category), size = 2) +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage < min ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage > max ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
scale_size_continuous(trans="sqrt") +
xlab("Age in Years BP")
dev.off()
View(filtered_data_metazoan)
ggplot() +
geom_jitter(data = subset(joined_data, grepl("Metazoa", tax_path)), aes(x=Age, y=MAP_damage, size = N_reads), alpha =0.5) +
geom_line(data = mfd, aes(x=age, y=DNAdamage, color=category), size = 1) +
scale_color_brewer(palette="Spectral") +
geom_point(data = mfd, aes(x=age, y=DNAdamage, color=category), size = 2) +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage < min ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage > max ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
scale_size_continuous(trans="sqrt") +
xlab("Age in Years BP")
View(pb9)
View(joined_data)
# Filter the joined data frame based on the minimum and maximum values for all genuses
filtered_data_genus <- joined_data %>%
filter(MAP_damage >= min & MAP_damage <= max)
filtered_data_genus
#add columns
filtered_data_genus <- filtered_data_genus %>%
mutate(Col_fact = "Fitting")
filtered_data_genus <- filtered_data_genus %>%
mutate(Filtering = "Ancient")
#dataset discarded taxa min threshold
filtered_data_genus_min <- joined_data %>%
filter(MAP_damage < min)
filtered_data_genus_min
#add columns then
filtered_data_genus_min <- filtered_data_genus_min %>%
mutate(Col_fact = "Outlier_min")
filtered_data_genus_min <- filtered_data_genus_min %>%
mutate(Filtering = "Not_ancient")
View(dt_plant)
View(mfd)
## Highlight taxa with more than 500 reads
mfd <- mydata %>% filter(N_reads == 500)
View(mfd)
View(mydata)
tb1 <- dt %>% filter(N_reads >= 100, mean_L > MinLength, MAP_significance  > MS2,  grepl("",tax_path), grepl("\\bgenus\\b", tax_rank), grepl("", sample))
dt_plant <- dt %>% filter(N_reads >= 500, mean_L > MinLength, MAP_significance  > MS2,  grepl("Viridiplantae",tax_path), grepl("\\bgenus\\b", tax_rank), grepl("", sample))
unique(dt_plant$tax_name)
##Density plot for plants > 500 reads ####to be checked #######
dtX <- dt1 %>% filter(N_reads >= 500)
View(dtX)
View(dt1)
##Density plot for plants > 500 reads ####to be checked #######
dtX <- dt1 %>% filter(N_reads >= 500)  %>% filter(tax_name!="Zostera")
View(dtX)
dt_plant <- dt %>% filter(N_reads >= 500, mean_L > MinLength, MAP_significance  > MS2,  grepl("Viridiplantae",tax_path), grepl("\\bgenus\\b", tax_rank), grepl("", sample),tax_name!="Zostera")
View(dt_plant)
unique(dt_plant$tax_name)
# create filtering table
## calculate stats and combine data
pb4 <-dt_plant %>%
group_by(sample) %>%
summarise(mode = tapply(MAP_damage,sample, getmode))
pb4a <- dt_plant %>%
group_by(sample) %>%
summarise(A_mode = tapply(MAP_damage,sample, estimate_mode))
pb5 <- dt_plant %>%
group_by(sample) %>%
summarise(min = tapply(MAP_damage,sample, min))
pb6 <- dt_plant %>%
group_by(sample) %>%
summarise(max = tapply(MAP_damage,sample, max))
pb7 <- dt_plant %>%
group_by(sample) %>%
summarise(median = tapply(MAP_damage,sample, median))
pb8 <- dt_plant %>%
group_by(sample) %>%
summarise(sd = tapply(MAP_damage,sample, sd))
# binding them to table, and adding ages
pb9 <- cbind(pb4, pb4a[,2], pb5[,2], pb6[,2], pb7[,2], pb8[,2])
#add age
pb9$Age <-metadataAge$Median[match(gsub("^[^-]+-[^-]+-([^_]+)_.*$", "\\1",pb9$sample), metadataAge$Sample)]
View(pb9)
#checking the classes of the rows and changing these to be numeric
sapply(pb9, class)
x <- ncol(pb9)
pb9[, 2:x] <- lapply(pb9[, 2:x], as.numeric)
# Join the two data frames based on the sample ID
joined_data <- left_join(tb1, pb9, by = "sample")
View(joined_data)
# Filter the joined data frame based on the minimum and maximum values for all genuses
filtered_data_genus <- joined_data %>%
filter(MAP_damage >= min & MAP_damage <= max)
filtered_data_genus
#add columns
filtered_data_genus <- filtered_data_genus %>%
mutate(Col_fact = "Fitting")
filtered_data_genus <- filtered_data_genus %>%
mutate(Filtering = "Ancient")
#dataset discarded taxa min threshold
filtered_data_genus_min <- joined_data %>%
filter(MAP_damage < min)
filtered_data_genus_min
#add columns then
filtered_data_genus_min <- filtered_data_genus_min %>%
mutate(Col_fact = "Outlier_min")
filtered_data_genus_min <- filtered_data_genus_min %>%
mutate(Filtering = "Not_ancient")
#dataset discarded taxa max threshold
filtered_data_genus_max <- joined_data %>%
filter(MAP_damage > max)
filtered_data_genus_max
#add columns
filtered_data_genus_max <- filtered_data_genus_max %>%
mutate(Col_fact = "Outlier_max")
filtered_data_genus_max <- filtered_data_genus_max %>%
mutate(Filtering = "Ancient")
#making one table all genuses
filtered_data_genus_all <- rbind(filtered_data_genus, filtered_data_genus_max, filtered_data_genus_min)
# Filter the joined data frame based on the minimum and maximum values for only Metazoa
filtered_data_metazoan <- filtered_data_genus_all %>% filter(grepl("Metazoa",tax_path), grepl("\\bgenus\\b", tax_rank))
filtered_data_metazoan$Age <- metadataAge$Median[match(gsub("^[^-]+-[^-]+-([^_]+)_.*$", "\\1", filtered_data_metazoan$sample), metadataAge$Sample)]
###save csv
write.csv(filtered_data_metazoan, file = "cleanedData/filtered_metazoan_all.csv")
write.csv(filtered_data_genus_all, file = "cleanedData/filtered_genus_all.csv")
pb9
mfd
pb9
melt(pb9[,c(1,3,7)])
melt(pb9[,c(1,2,7)])
melt(pb9[,c(1,2,8)])
melt(pb9[,c(1,4,8)])
melt(pb9)
melt(pb9,variable.name = Age)
melt(pb9,variable.name ="Age")
melt(pb9,measure.vars = "Age")
melt(pb9,measure.vars =8)
melt(pb9,id.vars = 8)
melt(pb9,id.vars = 1,8)
pb9
melt(pb9, id.vars = c("sample", "Age"))
pb9.w <- melt(pb9, id.vars = c("sample", "Age"))
ggplot() +
geom_jitter(data = subset(joined_data, grepl("Metazoa", tax_path)), aes(x=Age, y=MAP_damage, size = N_reads), alpha =0.5) +
geom_line(data = pb9.w, aes(x=Age, y=value, color=variable), size = 1) +
scale_color_brewer(palette="Spectral") +
geom_point(data = mfd, aes(x=age, y=DNAdamage, color=category), size = 2) +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage < min ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage > max ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
scale_size_continuous(trans="sqrt") +
xlab("Age in Years BP")
pb9.w
pb9.w$Age
joined_data
# Join the two data frames based on the sample ID
joined_data <- left_join(tb1, pb9, by = "sample")
# Filter the joined data frame based on the minimum and maximum values for all genuses
filtered_data_genus <- joined_data %>%
filter(MAP_damage >= min & MAP_damage <= max)
filtered_data_genus
#add columns
filtered_data_genus <- filtered_data_genus %>%
mutate(Col_fact = "Fitting")
filtered_data_genus <- filtered_data_genus %>%
mutate(Filtering = "Ancient")
#dataset discarded taxa min threshold
filtered_data_genus_min <- joined_data %>%
filter(MAP_damage < min)
filtered_data_genus_min
#add columns then
filtered_data_genus_min <- filtered_data_genus_min %>%
mutate(Col_fact = "Outlier_min")
filtered_data_genus_min <- filtered_data_genus_min %>%
mutate(Filtering = "Not_ancient")
#dataset discarded taxa max threshold
filtered_data_genus_max <- joined_data %>%
filter(MAP_damage > max)
filtered_data_genus_max
#add columns
filtered_data_genus_max <- filtered_data_genus_max %>%
mutate(Col_fact = "Outlier_max")
filtered_data_genus_max <- filtered_data_genus_max %>%
mutate(Filtering = "Ancient")
#making one table all genuses
filtered_data_genus_all <- rbind(filtered_data_genus, filtered_data_genus_max, filtered_data_genus_min)
# Filter the joined data frame based on the minimum and maximum values for only Metazoa
filtered_data_metazoan <- filtered_data_genus_all %>% filter(grepl("Metazoa",tax_path), grepl("\\bgenus\\b", tax_rank))
filtered_data_metazoan$Age <- metadataAge$Median[match(gsub("^[^-]+-[^-]+-([^_]+)_.*$", "\\1", filtered_data_metazoan$sample), metadataAge$Sample)]
###save csv
write.csv(filtered_data_metazoan, file = "cleanedData/filtered_metazoan_all.csv")
write.csv(filtered_data_genus_all, file = "cleanedData/filtered_genus_all.csv")
ggplot() +
geom_jitter(data = subset(joined_data, grepl("Metazoa", tax_path)), aes(x=Age, y=MAP_damage, size = N_reads), alpha =0.5) +
geom_line(data = pb9.w, aes(x=Age, y=value, color=variable), size = 1) +
scale_color_brewer(palette="Spectral") +
geom_point(data = mfd, aes(x=age, y=DNAdamage, color=category), size = 2) +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage < min ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage > max ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
scale_size_continuous(trans="sqrt") +
xlab("Age in Years BP")
joined_data
View(joined_data)
joined_data$sample
pb9$Age <-metadataAge$Median[match(gsub("^[^-]+-[^-]+-([^_]+)_.*$", "\\1",joined_data$sample), metadataAge$Sample)]
joined_dat$Age <-metadataAge$Median[match(gsub("^[^-]+-[^-]+-([^_]+)_.*$", "\\1",joined_data$sample), metadataAge$Sample)]
# binding them to table, and adding ages
pb9 <- cbind(pb4, pb4a[,2], pb5[,2], pb6[,2], pb7[,2], pb8[,2])
#add age
pb9$Age <-metadataAge$Median[match(gsub("^[^-]+-[^-]+-([^_]+)_.*$", "\\1",pb9$sample), metadataAge$Sample)]
#checking the classes of the rows and changing these to be numeric
sapply(pb9, class)
x <- ncol(pb9)
pb9[, 2:x] <- lapply(pb9[, 2:x], as.numeric)
pb9.w <- melt(pb9, id.vars = c("sample", "Age"))
# Join the two data frames based on the sample ID
joined_data <- left_join(tb1, pb9, by = "sample")
joined_data$Age <-metadataAge$Median[match(gsub("^[^-]+-[^-]+-([^_]+)_.*$", "\\1",joined_data$sample), metadataAge$Sample)]
# Filter the joined data frame based on the minimum and maximum values for all genuses
filtered_data_genus <- joined_data %>%
filter(MAP_damage >= min & MAP_damage <= max)
filtered_data_genus
#add columns
filtered_data_genus <- filtered_data_genus %>%
mutate(Col_fact = "Fitting")
filtered_data_genus <- filtered_data_genus %>%
mutate(Filtering = "Ancient")
#dataset discarded taxa min threshold
filtered_data_genus_min <- joined_data %>%
filter(MAP_damage < min)
filtered_data_genus_min
#add columns then
filtered_data_genus_min <- filtered_data_genus_min %>%
mutate(Col_fact = "Outlier_min")
filtered_data_genus_min <- filtered_data_genus_min %>%
mutate(Filtering = "Not_ancient")
#dataset discarded taxa max threshold
filtered_data_genus_max <- joined_data %>%
filter(MAP_damage > max)
filtered_data_genus_max
#add columns
filtered_data_genus_max <- filtered_data_genus_max %>%
mutate(Col_fact = "Outlier_max")
filtered_data_genus_max <- filtered_data_genus_max %>%
mutate(Filtering = "Ancient")
#making one table all genuses
filtered_data_genus_all <- rbind(filtered_data_genus, filtered_data_genus_max, filtered_data_genus_min)
# Filter the joined data frame based on the minimum and maximum values for only Metazoa
filtered_data_metazoan <- filtered_data_genus_all %>% filter(grepl("Metazoa",tax_path), grepl("\\bgenus\\b", tax_rank))
filtered_data_metazoan$Age <- metadataAge$Median[match(gsub("^[^-]+-[^-]+-([^_]+)_.*$", "\\1", filtered_data_metazoan$sample), metadataAge$Sample)]
###save csv
write.csv(filtered_data_metazoan, file = "cleanedData/filtered_metazoan_all.csv")
write.csv(filtered_data_genus_all, file = "cleanedData/filtered_genus_all.csv")
#####ORIGINAL####
#plot metazoan reads and identify outliers based on the damage model
pdf(file = "figures/MTG.DNAdamageJitterPlot_finalAnimals100readsWithOutliers.pdf", width = 9, height = 6)
ggplot() +
geom_jitter(data = subset(joined_data, grepl("Metazoa", tax_path)), aes(x=Age, y=MAP_damage, size = N_reads), alpha =0.5) +
geom_line(data = mfd, aes(x=age, y=DNAdamage, color=category), size = 1) +
scale_color_brewer(palette="Spectral") +
geom_point(data = mfd, aes(x=age, y=DNAdamage, color=category), size = 2) +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage < min ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage > max ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
scale_size_continuous(trans="sqrt") +
xlab("Age in Years BP")
dev.off()
#####LUKE's version ####
#plot metazoan reads and identify outliers based on the damage model
ggplot() +
geom_jitter(data = subset(joined_data, grepl("Metazoa", tax_path)), aes(x=Age, y=MAP_damage, size = N_reads), alpha =0.5) +
geom_line(data = pb9.w, aes(x=Age, y=value, color=variable), size = 1) +
scale_color_brewer(palette="Spectral") +
geom_point(data = mfd, aes(x=age, y=DNAdamage, color=category), size = 2) +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage < min ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage > max ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
scale_size_continuous(trans="sqrt") +
xlab("Age in Years BP")
ggplot() +
geom_jitter(data = subset(joined_data, grepl("Metazoa", tax_path)), aes(x=Age, y=MAP_damage, size = N_reads), alpha =0.5) +
geom_line(data = pb9.w, aes(x=Age, y=value, color=variable), size = 1) +
scale_color_brewer(palette="Spectral") +
geom_point(data = pb9.w, aes(x=Age, y=value, color=variable), size = 1) +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage < min ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage > max ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
scale_size_continuous(trans="sqrt") +
xlab("Age in Years BP")
tax_path
ggplot() +
geom_jitter(data = subset(joined_data, grepl("Metazoa", tax_path)), aes(x=Age, y=MAP_damage, size = N_reads), alpha =0.5) +
geom_line(data = mfd, aes(x=age, y=DNAdamage, color=category), size = 1) +
scale_color_brewer(palette="Spectral") +
geom_point(data = mfd, aes(x=age, y=DNAdamage, color=category), size = 2) +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage < min ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage > max ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
scale_size_continuous(trans="sqrt") +
xlab("Age in Years BP")
ggplot() +
geom_jitter(data = subset(dt, grepl("Metazoa", tax_path)), aes(x=Age, y=MAP_damage, size = N_reads), alpha =0.5) +
geom_line(data = pb9.w, aes(x=Age, y=value, color=variable), size = 1) +
scale_color_brewer(palette="Spectral") +
geom_point(data = pb9.w, aes(x=Age, y=value, color=variable), size = 1) +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage < min ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage > max ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
scale_size_continuous(trans="sqrt") +
xlab("Age in Years BP")
# Join the two data frames based on the sample ID
joined_data <- left_join(tb1, pb9, by = "sample")
joined_data$Age <-metadataAge$Median[match(gsub("^[^-]+-[^-]+-([^_]+)_.*$", "\\1",joined_data$sample), metadataAge$Sample)]
View(joined_data)
ggplot() +
geom_jitter(data = subset(joined_data, grepl("Metazoa", tax_path)), aes(x=Age, y=MAP_damage, size = N_reads), alpha =0.5) +
geom_line(data = pb9.w, aes(x=Age, y=value, color=variable), size = 1) +
scale_color_brewer(palette="Spectral") +
geom_point(data = pb9.w, aes(x=Age, y=value, color=variable), size = 1) +
#geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage < min ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
#geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage > max ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
#scale_size_continuous(trans="sqrt") +
xlab("Age in Years BP")
pb9.w <- melt(pb9, id.vars = c("sample", "Age"),measure.vars = c("min","median","max"))
View(pb9.w)
ggplot() +
geom_jitter(data = subset(joined_data, grepl("Metazoa", tax_path)), aes(x=Age, y=MAP_damage, size = N_reads), alpha =0.5) +
geom_line(data = pb9.w, aes(x=Age, y=value, color=variable), size = 1) +
scale_color_brewer(palette="Spectral") +
geom_point(data = pb9.w, aes(x=Age, y=value, color=variable), size = 1) +
#geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage < min ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
#geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage > max ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
#scale_size_continuous(trans="sqrt") +
xlab("Age in Years BP")
pb9.w <- melt(pb9, id.vars = c("sample", "Age"),measure.vars = c("max","median","min"))
# Join the two data frames based on the sample ID
joined_data <- left_join(tb1, pb9, by = "sample")
joined_data$Age <-metadataAge$Median[match(gsub("^[^-]+-[^-]+-([^_]+)_.*$", "\\1",joined_data$sample), metadataAge$Sample)]
# Filter the joined data frame based on the minimum and maximum values for all genuses
filtered_data_genus <- joined_data %>%
filter(MAP_damage >= min & MAP_damage <= max)
filtered_data_genus
#add columns
filtered_data_genus <- filtered_data_genus %>%
mutate(Col_fact = "Fitting")
filtered_data_genus <- filtered_data_genus %>%
mutate(Filtering = "Ancient")
#dataset discarded taxa min threshold
filtered_data_genus_min <- joined_data %>%
filter(MAP_damage < min)
filtered_data_genus_min
#add columns then
filtered_data_genus_min <- filtered_data_genus_min %>%
mutate(Col_fact = "Outlier_min")
filtered_data_genus_min <- filtered_data_genus_min %>%
mutate(Filtering = "Not_ancient")
#dataset discarded taxa max threshold
filtered_data_genus_max <- joined_data %>%
filter(MAP_damage > max)
filtered_data_genus_max
#add columns
filtered_data_genus_max <- filtered_data_genus_max %>%
mutate(Col_fact = "Outlier_max")
filtered_data_genus_max <- filtered_data_genus_max %>%
mutate(Filtering = "Ancient")
#making one table all genuses
filtered_data_genus_all <- rbind(filtered_data_genus, filtered_data_genus_max, filtered_data_genus_min)
# Filter the joined data frame based on the minimum and maximum values for only Metazoa
filtered_data_metazoan <- filtered_data_genus_all %>% filter(grepl("Metazoa",tax_path), grepl("\\bgenus\\b", tax_rank))
filtered_data_metazoan$Age <- metadataAge$Median[match(gsub("^[^-]+-[^-]+-([^_]+)_.*$", "\\1", filtered_data_metazoan$sample), metadataAge$Sample)]
###save csv
write.csv(filtered_data_metazoan, file = "cleanedData/filtered_metazoan_all.csv")
write.csv(filtered_data_genus_all, file = "cleanedData/filtered_genus_all.csv")
ggplot() +
geom_jitter(data = subset(joined_data, grepl("Metazoa", tax_path)), aes(x=Age, y=MAP_damage, size = N_reads), alpha =0.5) +
geom_line(data = pb9.w, aes(x=Age, y=value, color=variable), size = 1) +
scale_color_brewer(palette="Spectral") +
geom_point(data = pb9.w, aes(x=Age, y=value, color=variable), size = 1) +
#geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage < min ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
#geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage > max ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
#scale_size_continuous(trans="sqrt") +
xlab("Age in Years BP")
geom_jitter(data = subset(joined_data, aes(x=Age, y=MAP_damage, size = N_reads), alpha =0.5) +
ggplot() +
geom_jitter(data = joined_data, aes(x=Age, y=MAP_damage, size = N_reads), alpha =0.5) +
geom_line(data = pb9.w, aes(x=Age, y=value, color=variable), size = 1) +
scale_color_brewer(palette="Spectral") +
geom_point(data = pb9.w, aes(x=Age, y=value, color=variable), size = 1) +
#geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage < min ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
#geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage > max ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
#scale_size_continuous(trans="sqrt") +
xlab("Age in Years BP")
grepl("Metazoa", tax_path)
subset(joined_data, grepl("Metazoa", tax_path))
ggplot() +
geom_jitter(data = subset(joined_data, grepl("Metazoa", tax_path)), aes(x=Age, y=MAP_damage, size = N_reads), alpha =0.2) +
geom_line(data = pb9.w, aes(x=Age, y=value, color=variable), size = 1) +
scale_color_brewer(palette="Spectral") +
geom_point(data = pb9.w, aes(x=Age, y=value, color=variable), size = 1) +
#geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage < min ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
#geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage > max ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
#scale_size_continuous(trans="sqrt") +
xlab("Age in Years BP")
ggplot() +
geom_jitter(data = subset(joined_data, grepl("Metazoa", tax_path)), aes(x=Age, y=MAP_damage, size = N_reads), alpha =0.3) +
geom_line(data = pb9.w, aes(x=Age, y=value, color=variable), size = 1) +
scale_color_brewer(palette="Spectral") +
geom_point(data = pb9.w, aes(x=Age, y=value, color=variable), size = 1) +
#geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage < min ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
#geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage > max ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
#scale_size_continuous(trans="sqrt") +
xlab("Age in Years BP")
ggplot() +
geom_jitter(data = subset(joined_data, grepl("Metazoa", tax_path)), aes(x=Age, y=MAP_damage, size = N_reads), alpha =0.3) +
geom_line(data = pb9.w, aes(x=Age, y=value, color=variable), size = 1) +
scale_color_brewer(palette="Spectral") +
geom_point(data = pb9.w, aes(x=Age, y=value, color=variable), size = 1) +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage < min ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage > max ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
#scale_size_continuous(trans="sqrt") +
xlab("Age in Years BP")
ggplot() +
geom_jitter(data = subset(joined_data, grepl("Metazoa", tax_path)), aes(x=Age, y=MAP_damage, size = N_reads), alpha =0.3) +
geom_line(data = pb9.w, aes(x=Age, y=value, color=variable), size = 1) +
scale_color_brewer(palette="Spectral") +
geom_point(data = pb9.w, aes(x=Age, y=value, color=variable), size = 1) +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage < min ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage > max ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
scale_size_continuous(trans="sqrt") +
xlab("Age in Years BP")
ggplot() +
geom_jitter(data = subset(joined_data, grepl("Metazoa", tax_path)), aes(x=Age, y=MAP_damage, size = N_reads), alpha =0.3) +
geom_line(data = pb9.w, aes(x=Age, y=value, color=variable), size = 1) +
scale_color_brewer(palette="Spectral") +
geom_point(data = pb9.w, aes(x=Age, y=value, color=variable), size = 1) +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage < min ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage > max ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
#scale_size_continuous(trans="sqrt") +
xlab("Age in Years BP")
pdf(file = "figures/MTG.DNAdamageJitterPlot_finalAnimals100readsWithOutliers.pdf", width = 9, height = 6)
ggplot() +
geom_jitter(data = subset(joined_data, grepl("Metazoa", tax_path)), aes(x=Age, y=MAP_damage, size = N_reads), alpha =0.3) +
geom_line(data = pb9.w, aes(x=Age, y=value, color=variable), size = 1) +
scale_color_brewer(palette="Spectral") +
geom_point(data = pb9.w, aes(x=Age, y=value, color=variable), size = 1) +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage < min ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
geom_text(data = subset(joined_data, grepl("Metazoa", tax_path) & MAP_damage > max ), aes(x =Age, y = MAP_damage, label = tax_name), size = 3, color = "black") +
#scale_size_continuous(trans="sqrt") +
xlab("Age in Years BP")
dev.off()
